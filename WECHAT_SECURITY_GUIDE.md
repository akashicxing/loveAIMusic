
# 微信安全认证密钥使用说明

## 📋 生成的文件

1. **wechat_private_key.pem** - 应用私钥
   - 用于生成请求签名
   - 请妥善保管，不要泄露

2. **wechat_public_key.pem** - 应用公钥
   - 需要上传到微信开放平台
   - 用于微信验证您的签名

3. **wechat_platform_cert.pem** - 平台证书（需要手动下载）
   - 从微信开放平台下载
   - 用于验证微信回调的签名

4. **wechat-security-config.env** - 环境变量配置
   - 包含所有必要的配置项
   - 请复制到您的 .env 文件中

## 🔧 配置步骤

### 1. 上传公钥到微信开放平台
1. 登录微信开放平台
2. 进入"管理中心 - 网站应用 - 应用详情 - 开发配置 - API 安全"
3. 在"API非对称密钥"处上传 wechat_public_key.pem 的内容
4. 下载平台证书，保存为 wechat_platform_cert.pem

### 2. 配置环境变量
1. 复制 wechat-security-config.env 的内容
2. 添加到您的 .env.local 或 .env.production 文件
3. 填入真实的微信AppID和AppSecret

### 3. 测试安全认证
1. 启动应用
2. 访问 /test-wechat 页面
3. 检查安全认证状态

## ⚠️ 安全注意事项

1. **私钥安全**: 应用私钥必须妥善保管，不要提交到代码仓库
2. **证书更新**: 平台证书可能会更新，需要定期检查
3. **HTTPS要求**: 微信安全认证需要HTTPS环境
4. **域名配置**: 确保业务域名已在微信开放平台配置

## 🐛 故障排查

### 常见问题
1. **签名验证失败**: 检查公钥是否正确上传到微信开放平台
2. **证书验证失败**: 检查平台证书是否正确下载和配置
3. **加密失败**: 检查AES密钥是否正确配置
4. **网络错误**: 确保服务器可以访问微信API

### 调试方法
1. 查看服务器日志中的微信安全认证相关日志
2. 使用 /api/auth/wechat/verify 接口测试签名验证
3. 检查环境变量是否正确加载

## 📞 技术支持

如遇问题，请参考：
- 微信开放平台文档
- 项目中的 WECHAT_LOGIN_GUIDE.md
- 服务器日志和错误信息
