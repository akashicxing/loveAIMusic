"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[649],{3537:function(s,t,e){var a=e(8870),r=e(4705),c=e(6540),i=e(118),n=e(758),o=e.n(n),l=e(4848);class h extends c.Component{constructor(){super(...arguments),(0,r.A)(this,"state",{works:[],loading:!1,currentPlaying:null}),(0,r.A)(this,"loadWorks",async()=>{this.setState({loading:!0});try{const s=o().getStorageSync("token"),t=await o().request({url:"https://aimusic.sale/api/works/list",method:"GET",header:{Authorization:"Bearer ".concat(s)}});if(!t.data.success)throw new Error(t.data.message);this.setState({works:t.data.data||[],loading:!1})}catch(s){console.error("\u52a0\u8f7d\u4f5c\u54c1\u5931\u8d25:",s),o().showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"error"}),this.setState({loading:!1})}}),(0,r.A)(this,"playMusic",(s,t)=>{const{currentPlaying:e}=this.state;e===s?(o().stopBackgroundAudio(),this.setState({currentPlaying:null})):o().playBackgroundAudio({dataUrl:t,title:"\u4e3a\u7231\u800c\u6b4c",success:()=>{this.setState({currentPlaying:s})},fail:s=>{console.error("\u64ad\u653e\u5931\u8d25:",s),o().showToast({title:"\u64ad\u653e\u5931\u8d25",icon:"error"})}})}),(0,r.A)(this,"shareWork",s=>{o().showShareMenu({withShareTicket:!0,success:()=>{o().showToast({title:"\u5206\u4eab\u6210\u529f",icon:"success"})}})}),(0,r.A)(this,"deleteWork",async s=>{const t=await o().showModal({title:"\u786e\u8ba4\u5220\u9664",content:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u4f5c\u54c1\u5417\uff1f"});if(t.confirm)try{const t=o().getStorageSync("token"),e=await o().request({url:"https://aimusic.sale/api/works/".concat(s),method:"DELETE",header:{Authorization:"Bearer ".concat(t)}});if(!e.data.success)throw new Error(e.data.message);o().showToast({title:"\u5220\u9664\u6210\u529f",icon:"success"}),this.loadWorks()}catch(s){console.error("\u5220\u9664\u5931\u8d25:",s),o().showToast({title:"\u5220\u9664\u5931\u8d25",icon:"error"})}}),(0,r.A)(this,"startCreation",()=>{o().switchTab({url:"/pages/create/create"})}),(0,r.A)(this,"renderWorkItem",s=>{const{currentPlaying:t}=this.state,e=t===s.id;return(0,l.jsxs)(i.Ss,{className:"work-item",children:[(0,l.jsxs)(i.Ss,{className:"work-header",children:[(0,l.jsx)(i.EY,{className:"work-title",children:s.title}),(0,l.jsx)(i.EY,{className:"work-date",children:s.createdAt})]}),(0,l.jsx)(i.Ss,{className:"work-content",children:(0,l.jsx)(i.EY,{className:"work-lyrics",children:s.lyrics})}),(0,l.jsxs)(i.Ss,{className:"work-actions",children:[s.musicUrl&&(0,l.jsxs)(i.$n,{className:"action-btn ".concat(e?"playing":""),onClick:()=>this.playMusic(s.id,s.musicUrl),children:[e?"\u23f8\ufe0f":"\u25b6\ufe0f"," ",e?"\u6682\u505c":"\u64ad\u653e"]}),(0,l.jsx)(i.$n,{className:"action-btn",onClick:()=>this.shareWork(s),children:"\ud83d\udce4 \u5206\u4eab"}),(0,l.jsx)(i.$n,{className:"action-btn delete-btn",onClick:()=>this.deleteWork(s.id),children:"\ud83d\uddd1\ufe0f \u5220\u9664"})]})]},s.id)})}componentDidMount(){this.loadWorks()}render(){const{works:s,loading:t}=this.state;return(0,l.jsxs)(i.Ss,{className:"works",children:[(0,l.jsxs)(i.Ss,{className:"works-header",children:[(0,l.jsx)(i.EY,{className:"works-title",children:"\u6211\u7684\u4f5c\u54c1"}),(0,l.jsx)(i.$n,{className:"btn-primary create-btn",onClick:this.startCreation,children:"\u5f00\u59cb\u521b\u4f5c"})]}),(0,l.jsx)(i.BM,{className:"works-content",scrollY:!0,children:t?(0,l.jsx)(i.Ss,{className:"loading",children:(0,l.jsx)(i.EY,{className:"loading-text",children:"\u52a0\u8f7d\u4e2d..."})}):s.length>0?(0,l.jsx)(i.Ss,{className:"works-list",children:s.map(s=>this.renderWorkItem(s))}):(0,l.jsxs)(i.Ss,{className:"empty-state",children:[(0,l.jsx)(i.EY,{className:"empty-icon",children:"\ud83c\udfb5"}),(0,l.jsx)(i.EY,{className:"empty-text",children:"\u8fd8\u6ca1\u6709\u4f5c\u54c1"}),(0,l.jsx)(i.EY,{className:"empty-desc",children:"\u5f00\u59cb\u521b\u4f5c\u4f60\u7684\u7b2c\u4e00\u9996\u60c5\u6b4c\u5427"}),(0,l.jsx)(i.$n,{className:"btn-primary",onClick:this.startCreation,children:"\u5f00\u59cb\u521b\u4f5c"})]})})]})}}var d={navigationBarTitleText:"\u6211\u7684\u4f5c\u54c1"},m=(0,a.eU)(h,"pages/works/works",{root:{cn:[]}},d||{});h&&h.behaviors&&(m.behaviors=(m.behaviors||[]).concat(h.behaviors));Page(m)}},function(s){var t=function(t){return s(s.s=t)};s.O(0,[907,96],function(){return t(3537)});s.O()}]);